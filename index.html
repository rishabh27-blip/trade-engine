<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">

<title>Trade Decision Engine</title>

<!-- IMPORTANT FOR GITHUB PAGES -->
<base href="/trade-engine/">

<link rel="manifest" href="./manifest.json">
<link rel="icon" href="./icon-192.png">
<link rel="stylesheet" href="styles.css">
</head>

<body>

<div class="container">
    <h1>ðŸ“Š Trade Decision Engine</h1>

    <!-- INSTALL (ALWAYS VISIBLE NOW) -->
    <button id="installBtn">ðŸ“± Install App</button>
    <p style="font-size:12px;color:#aaa;">
        If install doesn't open â†’ browser menu â†’ Add to Home Screen
    </p>

    <!-- INPUT -->
    <div class="box">
        <h2>Trade Inputs</h2>

        <input id="buy" placeholder="Buy Price (â‚¹/kg)">
        <input id="sell" placeholder="Sell Price (â‚¹/kg)">
        <input id="qty" placeholder="Quantity (kg)">
        <input id="transport" placeholder="Transport Cost (â‚¹/kg)">
        <input id="broker" placeholder="Broker Cost (â‚¹/kg)">
        <input id="days" placeholder="Holding Days">
        <input id="vol" placeholder="Volatility (â‚¹/kg/day)">
        <input id="rel" placeholder="Reliability (1-5)">

        <button onclick="evaluateTrade()">ðŸŽ¯ Evaluate</button>
        <button onclick="clearForm()">ðŸ”„ Clear</button>

        <div id="output"></div>
    </div>

    <!-- STATS -->
    <div id="stats"></div>

    <!-- HISTORY -->
    <div id="history"></div>

    <!-- ACTIONS -->
    <div class="actions">
        <button onclick="saveTrade()">ðŸ’¾ Save Trade</button>
        <button onclick="exportData()">ðŸ“¤ Export</button>
    </div>
</div>

<script src="app.js"></script>

<script>
let deferredPrompt = null;

// Capture install event
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
});

// Install button logic
document.getElementById('installBtn').onclick = async () => {

    if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
    } else {
        alert("Use browser menu â†’ Add to Home Screen");
    }
};

// Register service worker (IMPORTANT PATH FIX)
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/trade-engine/service-worker.js');
}
</script>

</body>
</html>
